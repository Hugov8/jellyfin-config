services:
  minio:
    image: 'minio/minio:latest'
    ports:
        - '9000:9000'
        - '8900:8900'
    environment:
        MINIO_ROOT_USER: minio
        MINIO_ROOT_PASSWORD: password
    volumes:
        - 'minio:/data/minio'
    command: 'minio server /data/minio --console-address ":8900"'
    healthcheck:
        test:
            - CMD
            - curl
            - '-f'
            - 'http://localhost:9000/minio/health/live'
        retries: 3
        timeout: 5s

  jellyfin:
    image: jellyfin/jellyfin
    container_name: jellyfin
    #user: uid:gid
    ports:
      - 8096:8096/tcp
      - 7359:7359/udp
    volumes:
      - ./config:/config
      - ./cache:/cache
      - ./media:/media
    restart: 'unless-stopped'
    # Optional - may be necessary for docker healthcheck to pass if running in host network mode
    extra_hosts:
      - 'host.docker.internal:host-gateway'

volumes:
  rclone_cache:
  media:
  minio:
    driver: local